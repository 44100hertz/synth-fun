#include <stdio.h>
#include <math.h>
#include "struct.h"

static const uint16_t sineLUT[256] =
{
        0x00c9, 0x025b, 0x03ed, 0x057f, 0x0711, 0x08a3, 0x0a35, 0x0bc7,
        0x0d58, 0x0eea, 0x107b, 0x120d, 0x139e, 0x152e, 0x16bf, 0x184f,
        0x19e0, 0x1b70, 0x1cff, 0x1e8f, 0x201e, 0x21ac, 0x233b, 0x24c9,
        0x2657, 0x27e4, 0x2971, 0x2afe, 0x2c8a, 0x2e16, 0x2fa1, 0x312c,
        0x32b6, 0x3440, 0x35ca, 0x3753, 0x38db, 0x3a63, 0x3bea, 0x3d71,
        0x3ef7, 0x407c, 0x4201, 0x4385, 0x4509, 0x468c, 0x480e, 0x498f,
        0x4b10, 0x4c90, 0x4e10, 0x4f8e, 0x510c, 0x5289, 0x5405, 0x5581,
        0x56fb, 0x5875, 0x59ee, 0x5b66, 0x5cdd, 0x5e53, 0x5fc9, 0x613d,
        0x62b1, 0x6423, 0x6595, 0x6706, 0x6875, 0x69e4, 0x6b51, 0x6cbe,
        0x6e29, 0x6f94, 0x70fd, 0x7266, 0x73cd, 0x7533, 0x7698, 0x77fc,
        0x795e, 0x7ac0, 0x7c20, 0x7d7f, 0x7edd, 0x803a, 0x8195, 0x82ef,
        0x8448, 0x85a0, 0x86f6, 0x884b, 0x899f, 0x8af1, 0x8c42, 0x8d92,
        0x8ee0, 0x902d, 0x9179, 0x92c3, 0x940c, 0x9553, 0x9699, 0x97dd,
        0x9920, 0x9a62, 0x9ba2, 0x9ce1, 0x9e1e, 0x9f59, 0xa093, 0xa1cb,
        0xa302, 0xa437, 0xa56b, 0xa69d, 0xa7ce, 0xa8fd, 0xaa2a, 0xab55,
        0xac7f, 0xada8, 0xaece, 0xaff3, 0xb116, 0xb238, 0xb358, 0xb476,
        0xb592, 0xb6ad, 0xb7c6, 0xb8dd, 0xb9f2, 0xbb05, 0xbc17, 0xbd27,
        0xbe35, 0xbf41, 0xc04c, 0xc154, 0xc25b, 0xc360, 0xc462, 0xc563,
        0xc663, 0xc760, 0xc85b, 0xc954, 0xca4c, 0xcb41, 0xcc35, 0xcd26,
        0xce16, 0xcf03, 0xcfef, 0xd0d8, 0xd1c0, 0xd2a5, 0xd389, 0xd46a,
        0xd54a, 0xd627, 0xd702, 0xd7dc, 0xd8b3, 0xd988, 0xda5b, 0xdb2c,
        0xdbfa, 0xdcc7, 0xdd91, 0xde5a, 0xdf20, 0xdfe4, 0xe0a6, 0xe166,
        0xe223, 0xe2df, 0xe398, 0xe44f, 0xe504, 0xe5b6, 0xe667, 0xe715,
        0xe7c1, 0xe86a, 0xe912, 0xe9b7, 0xea5a, 0xeafb, 0xeb99, 0xec35,
        0xeccf, 0xed67, 0xedfc, 0xee8f, 0xef20, 0xefae, 0xf03a, 0xf0c4,
        0xf14c, 0xf1d1, 0xf253, 0xf2d4, 0xf352, 0xf3ce, 0xf447, 0xf4be,
        0xf533, 0xf5a6, 0xf616, 0xf683, 0xf6ee, 0xf757, 0xf7be, 0xf822,
        0xf884, 0xf8e3, 0xf940, 0xf99a, 0xf9f2, 0xfa48, 0xfa9b, 0xfaec,
        0xfb3b, 0xfb87, 0xfbd0, 0xfc17, 0xfc5c, 0xfc9f, 0xfcde, 0xfd1c,
        0xfd57, 0xfd8f, 0xfdc6, 0xfdf9, 0xfe2a, 0xfe59, 0xfe86, 0xfeaf,
        0xfed7, 0xfefc, 0xff1e, 0xff3e, 0xff5c, 0xff77, 0xff90, 0xffa6,
        0xffba, 0xffcb, 0xffda, 0xffe6, 0xfff0, 0xfff7, 0xfffc, 0xffff
};

// Sine wave.
double gen_sine(double phase)
{
        uint16_t intPosition = (phase * 256 * 4);
        uint16_t posLUT = intPosition % 256;

        if(intPosition % 512 > 255)
                posLUT = 256 - posLUT;

        if(intPosition > 512)
                return (sineLUT[posLUT] / (double)0xffff / 2.0) + 0.5;
        else
                return (sineLUT[posLUT] / (double)0xffff / -2.0);
}

double gen_preciseSine(double phase)
{
        return sin(phase * M_PI * 2.0) * 0.5 + 0.5;
}

// Square wave w/aliasing.
double gen_square(double phase)
{
	if( phase >= 0.5 ) {
		return( 0 );
	} else {
		return( 1 );
	}
}

// Triangle wave w/aliasing
double gen_triangle(double phase)
{
	return( fabs(phase - 1.0) * 2.0 );
}

// Used for envelopes
double gen_1poly(double phase, double a, double power)
{
	return pow((1 - phase), power) * a;
}
